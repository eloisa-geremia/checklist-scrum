<form id="form"> 
  <input 
    type="text" 
    id="inputTarefa" 
    placeholder="Digite algo..." 
    oninput="verificarCampo()" 
  />

  <button 
    type="submit" 
    id="btnSalvar" 
    disabled
  >
    Salvar
  </button>
  
  <!-- mensagem de erro inline -->
  <p id="erroMsg" style="color: red; font-size: 14px;"></p>
</form>

<ul id="listaTarefas"></ul>

<script>
  const input = document.getElementById("inputTarefa");
  const btn = document.getElementById("btnSalvar");
  const form = document.getElementById("form");
  const erroMsg = document.getElementById("erroMsg");
  const lista = document.getElementById("listaTarefas");

  function verificarCampo() {
    if (input.value.trim() === "") {
      btn.disabled = true;
      erroMsg.textContent = "O campo não pode estar vazio!";
    } else {
      btn.disabled = false;
      erroMsg.textContent = "";
    }
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (input.value.trim() === "") {
      erroMsg.textContent = "O campo não pode estar vazio!";
      return;
    }

    btn.disabled = true;
    btn.textContent = "Salvando...";
    erroMsg.textContent = "";

    try {
      const response = await fetch("http://localhost:3000/tasks", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tarefa: input.value })
      });

      if (!response.ok) {
        throw new Error("Erro ao salvar tarefa no servidor");
      }

      const novaTarefa = await response.json();

      // adiciona na lista visual
      const li = document.createElement("li");
      li.textContent = novaTarefa.tarefa; // assume que o backend retorna { tarefa: "texto" }
      lista.appendChild(li);

      // reset
      input.value = "";
      verificarCampo();
    } catch (err) {
      erroMsg.textContent = err.message;
    } finally {
      btn.textContent = "Salvar";
      verificarCampo();
    }
  });
</script>
